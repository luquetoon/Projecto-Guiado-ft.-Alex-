CREATE TABLE USUARIOS (
    USER_ID NUMBER(255) NOT NULL PRIMARY KEY,
    DB_USERNAME VARCHAR2(255) NOT NULL,
    DB_PASSWORD VARCHAR2(255) NOT NULL,
    TLF INT NOT NULL,
    ROL VARCHAR2(3) NOT NULL CHECK (ROL IN ('EMP','SUP','TEC')),
    LOC_TRABAJO VARCHAR2(255), 
    UBICACION VARCHAR2(255),
    EMPRESA_EXT VARCHAR2(255)
);

CREATE TABLE TICKET (
    TICKET_ID NUMBER(255) NOT NULL PRIMARY KEY,
    CATEGORIA VARCHAR2(255) NOT NULL,
    PRIORIDAD NUMBER(255) NOT NULL,
    DESCRIPCION VARCHAR2(255),
    SEGUIMIENTO VARCHAR2(255),
);

CREATE TABLE ACCIONES (
    ACTION_ID NUMBER(255) NOT NULL PRIMARY KEY,
    AC_TYPE VARCHAR(255) NOT NULL CHECK (AC_TYPE IN ('CREATE','CLOSE','ASSIGN','INTERVENTION')),
    AC_DATE TIMESTAMP NOT NULL,
    ACTOR NUMBER(255) NOT NULL,
    TICKET_REF NUMBER(255) NOT NULL,
    CONSTRAINT FK_ACTOR FOREIGN KEY (ACTOR) REFERENCES USUARIOS(USER_ID),
    CONSTRAINT FK_TICKET FOREIGN KEY (TICKET_REF) REFERENCES TICKET(TICKET_ID)
);

CREATE TABLE MODDERS (
    MODDER_ID NUMBER(255) NOT NULL,
    TICKET_REF_ID NUMBER(255) NOT NULL,
    PRIMARY KEY (MODDER_ID, TICKET_REF_ID),
    FOREIGN KEY(MODDER_ID) REFERENCES ACCIONES(ACTOR),
    FOREIGN KEY(TICKET_REF_ID) REFERENCES TICKET(TICKET_REF)
);
-- La tabla modders está diseñada para añadir los usuarios con permiso de cerrar un ticket sin usar un join.
